---
title: 筛选器管理器概念
description: 筛选器管理器概念
ms.assetid: 5b11671f-02fd-4d0e-8199-c345bbf2591c
keywords:
- 筛选器管理器 WDK 文件系统微筛选器，关于筛选器管理器
- 海拔 WDK 文件系统微筛选器
- 筛选器管理器 WDK 文件系统微筛选器，体系结构
ms.date: 02/03/2020
ms.localizationpriority: medium
ms.openlocfilehash: 371bef8c01aab483425671ae10db7d6e492c1c02
ms.sourcegitcommit: 8c898615009705db7633649a51bef27a25d72b26
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/07/2020
ms.locfileid: "78910440"
---
# <a name="filter-manager-concepts"></a>筛选器管理器概念

筛选器管理器是符合旧文件系统筛选器模型的内核模式驱动程序。 它实现并公开文件系统筛选器驱动程序中通常需要的功能。 利用此功能，第三方开发人员可以编写微筛选器驱动程序，这比旧的文件系统筛选器驱动程序更简单，从而缩短开发过程，同时生成更高质量、更可靠的驱动程序。

筛选器管理器随 Windows 一起安装，但仅当加载微筛选器驱动程序时才会变为活动状态。 筛选器管理器将附加到目标卷的文件系统堆栈。 微筛选器驱动程序通过向筛选器管理器注册筛选器驱动程序选择筛选的 i/o 操作，来间接附加到文件系统堆栈。

微筛选器驱动程序按特定顺序附加。 附件的顺序取决于称为 "*海拔*" 的唯一标识符。 特定卷上特定海拔高度的微筛选器驱动程序的附件称为微筛选器驱动程序的*实例*。

微筛选器驱动程序的高度确保在相对于其他微筛选器驱动程序实例的适当位置上始终加载微筛选器驱动程序的实例，并确定筛选器管理器调用微筛选器驱动程序处理 i/o 的顺序。 等级由 Microsoft 分配和管理。

下图显示了带有筛选器管理器和三个微筛选器驱动程序的简化 i/o 堆栈。

![阐释带有筛选器管理器和三个微筛选器驱动程序的简化 i/o 堆栈的关系图](images/filter-manager-architecture-1.gif)

微筛选器驱动程序可以筛选基于 IRP 的 i/o 操作以及快速 i/o 和文件系统筛选器（FSFilter）回调操作。 对于它选择进行筛选的每个 i/o 操作，微筛选器驱动程序可以注册一个[preoperation 回调例程](writing-preoperation-and-postoperation-callback-routines.md)，也可以注册 postoperation 回调例程。 处理 i/o 操作时，筛选器管理器将为为该操作注册的每个微筛选器驱动程序调用相应的回调例程。 当该回调例程返回时，筛选器管理器将为为操作注册的下一个微筛选器驱动程序调用相应的回调例程。

例如，假设上图中的所有三个微微筛选器驱动程序都注册了相同的 i/o 操作，则筛选器管理器将按海拔从高到低（A，B，C）的顺序调用其 preoperation 回调例程，然后将 i/o 请求转发到下一个较低的驱动程序，以便进一步处理。 当筛选器管理器接收到完成的 i/o 请求时，它将按相反的顺序（从最低到最高（C，B，A））调用每个微筛选器驱动程序的 postoperation 回调例程。

为了实现与旧版筛选器驱动程序的互操作性，筛选器管理器可以在多个位置将筛选器设备对象附加到文件系统 i/o 堆栈。 每个筛选器管理器的筛选器设备对象称为 "*帧*"。 从旧筛选器驱动程序的角度来看，每个筛选器管理器框架只是另一个旧版筛选器驱动程序。

每个筛选器管理器框架都表示一组高度。 筛选器管理器可以调整现有框架，或创建新帧以允许微筛选器驱动程序连接到正确的位置。

筛选器管理器无法在两个附加的旧筛选器之间附加微筛选器，除非它们之间已存在筛选器管理器框架。 如果要将微筛选器附加到旧筛选器之上，则可以将其附加到它的下方，具体取决于是否存在其他附加的旧筛选器。 要附加到旧筛选器之上的微筛选器可以改为附加到旧筛选器之上。

> [!IMPORTANT]
> 请始终验证旧版筛选器与 minifilters 的互操作性，或考虑将旧筛选器替换为 minifilters。 有关详细信息，请参阅[迁移旧筛选器驱动程序的准则](guidelines-for-porting-legacy-filter-drivers.md)。

如果卸载并重新加载了微筛选器驱动程序，则会在卸载该驱动程序的相同帧上重新加载该驱动程序。

下图显示了一个具有两个筛选器管理器帧、微筛选器驱动程序实例和旧筛选器驱动程序的简化 i/o 堆栈。

![阐释带有两个筛选器管理器帧、微筛选器驱动程序实例和旧筛选器驱动程序的简化 i/o 堆栈的关系图](images/filter-manager-architecture-2.gif)
