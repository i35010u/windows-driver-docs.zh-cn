---
title: 电源管理
description: 电源管理
ms.assetid: b47ed463-2292-419a-af16-196382dbd3f1
keywords:
- 电源管理 WDK 打印机
- 关键关闭 WDK 打印机
- 关闭电源管理 WDK 打印机
- 备用测试 WDK 打印机
- 休眠测试 WDK 打印机
ms.date: 06/11/2020
ms.localizationpriority: medium
ms.openlocfilehash: 57a021c2c2520d0e0ad404bc986f70ab523040f6
ms.sourcegitcommit: adccef85b24a37b1caa51e1b3435741a2f022cd5
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/12/2020
ms.locfileid: "84724408"
---
# <a name="power-management"></a>电源管理

当系统循环进入各种睡眠状态，并且设备无法正确设置设备电源状态或从不同设备电源状态返回时，将会发生连接端口的设备的一些最常见故障。 系统应始终像从完全关闭的状态（"冷启动"）启动。 输入或从睡眠状态中唤醒的唯一行为很有可能是错误。

遵循这些基本规则，确保设备正常运行。

1. 设备、端口及其驱动程序不应阻止或阻止系统进入睡眠状态。

1. 正在进行的打印作业不应阻止请求转为降低电源状态。

1. 当系统从睡眠状态中唤醒时，启动较低电源状态时正在进行的任何打印作业都应正常恢复。

1. 关键关闭请求将覆盖任何拒绝电源状态更改的尝试。

有关详细信息，请参阅[系统电源状态](https://docs.microsoft.com/windows-hardware/drivers/kernel/system-power-states)。

## <a name="testing-port-connected-devices-across-various-power-states"></a>跨各种电源状态测试端口连接的设备

若要在各种电源状态之前和之后开始测试设备，请先验证设备的基线[即插即用](https://docs.microsoft.com/windows-hardware/drivers/kernel/implementing-plug-and-play)（PnP）功能。 接下来，验证你的测试环境是否可以进入并唤醒所有电源状态。

如果已正确连接并安装了一台设备，请按如下方式在每个电源状态 S0 到 S5 之前和之后测试其行为：

- **备用测试（S1-S3）**

    1. 进入并从备用状态中唤醒，并连接设备且不会有作业正在进行。 系统应正常输入每个睡眠和唤醒状态。

    1. 验证设备在进入睡眠状态之前和之后是否正常工作。 在未安装设备的情况下重复相同的测试。

    1. 从待机状态唤醒后，尝试安装设备。 设备应安装成功。

    1. 验证是否正在从待机进入并唤醒，并显示正在进行的打印作业。 正在进行的作业应在唤醒时恢复。

    1. 验证作业是否可以取消、恢复，并在进入待机状态并从待机状态中唤醒时重新启动。

    1. 将设备置于[设备错误状态](device-error-states.md)中所述的每个错误状态。 验证作业是否可以取消、恢复，并在进入待机状态并从待机状态中唤醒时重新启动。

- **休眠测试（S4）**

    1. 进入 "休眠" 状态并从 "休眠" 状态唤醒，并且设备已连接，没有作业正在进行中。 系统应正常输入每个睡眠和唤醒状态。

    1. 验证设备在进入睡眠状态之前和之后是否正常工作。 在未安装设备的情况下重复相同的测试。

    1. 从休眠状态唤醒后，尝试安装设备。 设备应安装成功。

    1. 验证进入并从休眠状态中唤醒，打印作业正在进行中。 正在进行的作业应在唤醒时恢复。

    1. 将设备置于[设备错误状态](device-error-states.md)中所述的每个错误状态。 验证作业是否可以取消、恢复或从休眠状态中唤醒之后重新启动。

- **关机/重新启动（S5）**

    1. 在设备已连接并且没有作业正在进行时关闭系统。 系统应正常关闭。

    1. 验证设备在系统关机前后是否正常工作。 在未安装设备的情况下重复相同的测试。

    1. 请在关闭并重新启动系统后尝试安装设备。

    1. 关闭并重新启动包含打印作业的系统。 正在进行的作业应在重新启动时恢复。

    1. 将设备置于[设备错误状态](device-error-states.md)中所述的每个错误状态。 验证作业是否可以取消、恢复，并在从系统关闭或重新启动后重新启动。 处于错误状态的打印作业应在队列中通过关闭或重新启动保留，并且在关闭或重新启动后，打印作业应在错误状态清除后恢复。

- **关键关闭**

    1. 当可以请求关键的关闭事件时（例如，当达到严重电池电量时），计算机可以处于以上任何活动电源状态（S0-S4）。 验证设备在紧急关闭事件前后是否正常工作。 在未安装设备的情况下重复相同的测试。

    1. 尝试在关键关闭事件之后安装设备。

    1. 测试在电源管理器启动关键关闭事件时设备使用的条件，并且设备驱动程序不会禁止睡眠状态。

    1. 当打印作业正在进行时，将启动一个严重的关闭事件。 唤醒系统后，打印作业应重新启动并正常恢复。

    1. 将设备置于[设备错误状态](device-error-states.md)中所述的每个错误状态。 验证是否可以在从严重关机事件返回之后取消、恢复和重新启动作业。 处于错误状态的打印作业应在队列中通过关闭或重新启动保留，并且在关闭或重新启动后，打印作业应在错误状态清除后恢复。

    1. 在设备已安装且处于空闲状态时，使用从控制面板获取的 "**电源选项**" 应用程序启动系统睡眠状态。 验证系统在给定时间是否进入适当的睡眠状态。 在未安装设备的情况下重复此测试，并验证是否可以在系统唤醒后安装该设备。
